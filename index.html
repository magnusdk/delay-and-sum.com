<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="v3/style.css" />
    <link rel="stylesheet" href="v3/controls.css" />
    <title>ðŸŒŠ</title>

    <script defer data-domain="delay-and-sum.com" src="https://plausible.io/js/script.js"></script>
</head>

<body>
    <div class="contentContainer">
        <h1>ðŸŒŠ delay-and-sum.com ðŸŒŠ</h1>
    </div>

    <div class="appContainer">
        <div id="simulationContainer">
            <div id="mainCanvasContainer">
                <canvas id="backgroundCanvas" width="1000" height="1000"></canvas>
                <canvas id="secondarySimulationCanvas" width="100" height="100"></canvas>
                <canvas id="primarySimulationCanvas" width="1000" height="1000"></canvas>
                <canvas id="foregroundCanvas" width="1000" height="1000"></canvas>
            </div>
            <canvas id="timelineCanvas" width="1000" height="200"></canvas>
        </div>
        <div id="controlsContainer" class="controlsContainer"></div>

        <script src="/v3/js/gpu.min.js"></script>
        <script type="module">
            import { App } from './v3/js/app.js';
            import { params } from './v3/js/params.js';
            import { initControls } from '/v3/js/ui/controls.js';
            import { loadParamsFromURL } from "/v3/js/params.js";

            document.app = new App(
                document.getElementById('backgroundCanvas'),
                document.getElementById('primarySimulationCanvas'),
                document.getElementById('secondarySimulationCanvas'),
                document.getElementById('foregroundCanvas'),
                document.getElementById('timelineCanvas'),
            );
            loadParamsFromURL();
            initControls(document.getElementById("controlsContainer"), document.app);
            document.app.start();
        </script>
    </div>

    <div class="contentContainer">
        <h2>What is this?</h2>
        <p><strong>delay-and-sum.com</strong></delay-and-sum.com> is an app that calculates the pressure field generated by a linear phased array â€” kind of like a <i>(very)</i> simplified <a href="https://field-ii.dk/">Field II</a>. We model a set of transducer elements, each acts as a point source that sends out a gaussian-tapered sine in all directions. We sum the spatial impulse response of all these point sources and end up with a more complex pressure field.</p>

        <p>The app consists of three parts:
            <ol>
                <li>A main canvas that shows the calculated pressure field.</li>
                <li>A timeline canvas that shows a timeline of the signal sampled at a selected point <i>(blue dot in main canvas)</i>.</li>
                <li>A control panel that lets you change the parameters of the simulation.</li>
            </ol>
            Try dragging the pink or blue dot in the main canvas, or dragging the edges of the array around. You can also change the current time of the simulation by clicking/dragging over the timeline canvas. Have fun!
        </p>

        <p>A similar project is <a href="https://doi.org/10.1109/ULTSYM.2012.0412"><em>Huygens on speed: Interactive simulation of ultrasound pressure fields</em></a> â€” check it out!</p>

        <p>The app is powered by <a href="https://github.com/gpujs/gpu.js">GPU.js</a> <i>(and thus WebGL)</i> and runs
            locally in your browser. <a href="https://github.com/magnusdk/delay-and-sum.com">The source code is
                available on GitHub</a>.
            Please add feature-requests or bug-reports <a
                href="https://github.com/magnusdk/delay-and-sum.com/issues/new">on GitHub</a> or contact me at <a
                href="mailto:magnus.kvalevag@ntnu.no">magnus.kvalevag@ntnu.no</a>. <em><strong>delay-and-sum.com</strong> is partially funded by the Norwegian University of Science and Technology (NTNU)</em>.
        </p>
        <p>Have fun! :)</p>
    </div>
</body>